<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>USMC Training Portal</title>
<style>
body { margin:0; font-family:Arial, sans-serif; background:#0f172a; color:#e5e7eb; }
header { background:#020617; padding:15px; text-align:center; font-weight:bold; }
input, select, button, textarea { width:100%; padding:6px; margin:3px 0; border-radius:6px; border:none; }
button { background:#1d4ed8; color:white; cursor:pointer; }
button:hover { background:#2563eb; }
.card { background:#020617; padding:15px; margin:10px; border-radius:10px; }
.nav { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
.nav button { flex:1; }
.hidden { display:none; }
.avatar { width:80px; border-radius:50%; border:2px solid #1d4ed8; }
.schedule-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:5px; }
.schedule-cell { background:#131b2b; padding:5px; border-radius:6px; min-height:50px; position:relative; }
.schedule-lesson { background:#1d4ed8; margin:2px 0; padding:2px 4px; border-radius:4px; font-size:12px; cursor:pointer; }
.delete-btn { position:absolute; top:2px; right:2px; background:red; border:none; color:white; font-size:10px; border-radius:3px; cursor:pointer; }
.chat-message { background:#1e40af; padding:4px; margin:2px 0; border-radius:4px; font-size:12px; word-wrap: break-word; }
@media(max-width:768px){ .nav button{flex:100%;} .schedule-grid { grid-template-columns: repeat(1, 1fr); } }
</style>
</head>
<body>

<header>USMC ROBLOX TRAINING SYSTEM</header>

<div id="login" class="card">
<h2>Login</h2>
<input id="loginUser" placeholder="Username">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div id="app" class="hidden">
<div class="nav">
<button onclick="show('dashboard')">Dashboard</button>
<button onclick="show('schedule')">Schedule</button>
<button onclick="show('grades')">Grades</button>
<button onclick="show('attendance')">Attendance</button>
<button onclick="show('chat')">Chat</button>
<button onclick="show('admin')" id="adminBtn">Admin Panel</button>
<button onclick="show('trainer')" id="trainerBtn">Trainer Panel</button>
<button onclick="logout()">Logout</button>
</div>

<div id="dashboard" class="card"></div>
<div id="schedule" class="card hidden"></div>
<div id="grades" class="card hidden"></div>
<div id="attendance" class="card hidden"></div>
<div id="chat" class="card hidden"></div>
<div id="admin" class="card hidden"></div>
<div id="trainer" class="card hidden"></div>

<script>
// ------------------- LocalStorage -------------------
let users = JSON.parse(localStorage.getItem('users')) || {
  "ADMIN60487753641": {password:"MARC60487753641", role:"Admin", robloxId:"60487753641", rank:"Commander", class:"HQ"}
};
let schedule = JSON.parse(localStorage.getItem('schedule')) || {}; // {class:{Monday:[lesson1, lesson2]}}
let grades = JSON.parse(localStorage.getItem('grades')) || {}; // {username:[{title, score, attendance, trainer, date}]}
let messages = JSON.parse(localStorage.getItem('messages')) || []; // {from,to,content,type,date,image?}
let friends = JSON.parse(localStorage.getItem('friends')) || {}; // {username:[friend1,friend2]}
let currentUser = null;
function save(){ 
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('schedule', JSON.stringify(schedule));
  localStorage.setItem('grades', JSON.stringify(grades));
  localStorage.setItem('messages', JSON.stringify(messages));
  localStorage.setItem('friends', JSON.stringify(friends));
}

// ------------------- Login / Logout -------------------
function login(){
 let u=document.getElementById('loginUser').value;
 let p=document.getElementById('loginPass').value;
 if(users[u] && users[u].password===p){
   currentUser=u;
   document.getElementById('login').classList.add('hidden');
   document.getElementById('app').classList.remove('hidden');
   loadUI();
 } else alert('Invalid credentials');
}
function logout(){ location.reload(); }
function show(id){
 document.querySelectorAll('#app .card').forEach(c=>c.classList.add('hidden'));
 document.getElementById(id).classList.remove('hidden');
}

// ------------------- Dashboard -------------------
function loadUI(){
 let u=users[currentUser];
 document.getElementById('dashboard').innerHTML=`
 <h2>Welcome ${currentUser}</h2>
 <img class="avatar" src="https://www.roblox.com/headshot-thumbnail/image?userId=${u.robloxId}&width=150&height=150&format=png">
 <p>Rank: ${u.rank}</p>
 <p>Role: ${u.role}</p>
 <p>Class: ${u.class}</p>`;
 displaySchedule();
 displayGrades();
 displayFriends();
 if(u.role!=='Admin') document.getElementById('adminBtn').style.display='none';
 if(u.role!=='Trainer') document.getElementById('trainerBtn').style.display='none';
 if(u.role==='Admin') loadAdmin();
 if(u.role==='Trainer') loadTrainerPanel();
}

// ------------------- Schedule -------------------
let currentWeekMonday = new Date();
currentWeekMonday.setDate(currentWeekMonday.getDate() - currentWeekMonday.getDay() + 1);

function displaySchedule(){
 let u=users[currentUser];
 let regimentSchedule = schedule[u.class] || {};
 let html = `<h3>Week of ${currentWeekMonday.toDateString()}</h3>
 <button onclick="prevWeek()">Previous Week</button>
 <button onclick="nextWeek()">Next Week</button>
 <div class="schedule-grid">`;
 let days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
 days.forEach(day=>{
   html+=`<div class="schedule-cell"><strong>${day}</strong>`;
   let lessons = regimentSchedule[day]||[];
   lessons.forEach((l,i)=>{
     html+=`<div class="schedule-lesson">${l.trainingType} ${l.time} <br> Trainer: ${l.trainerUser} (${l.trainerRank}) <br> Location: ${l.location} 
     <button class="delete-btn" onclick="deleteLesson('${u.class}','${day}',${i})">x</button></div>`;
   });
   html+='</div>';
 });
 html+='</div>';
 document.getElementById('schedule').innerHTML=html;
}
function nextWeek(){ currentWeekMonday.setDate(currentWeekMonday.getDate()+7); displaySchedule(); }
function prevWeek(){ currentWeekMonday.setDate(currentWeekMonday.getDate()-7); displaySchedule(); }
function deleteLesson(cls, day, index){
 schedule[cls][day].splice(index,1);
 save();
 displaySchedule();
}

// ------------------- Grades -------------------
function displayGrades(){
 let userGrades = grades[currentUser] || [];
 let html='<h2>Your Grades</h2>';
 userGrades.forEach(g=>{
   html+=`<p>${g.title}: ${g.score} | Attendance: ${g.attendance} | Trainer: ${g.trainer}</p>`;
 });
 document.getElementById('grades').innerHTML=html;
}

// ------------------- Friends -------------------
function displayFriends(){
 let userFriends = friends[currentUser] || [];
 let html='<h2>Friends</h2>';
 userFriends.forEach(f=>{
   html+=`<p>${f} <button onclick="removeFriend('${f}')">Remove</button></p>`;
 });
 html+='<input id="addFriendInput" placeholder="Add friend"><button onclick="addFriend()">Add Friend</button>';
 document.getElementById('dashboard').innerHTML += html;
}
function addFriend(){
 let f=document.getElementById('addFriendInput').value;
 if(!friends[currentUser]) friends[currentUser]=[];
 if(!friends[currentUser].includes(f)) friends[currentUser].push(f);
 save(); displayFriends();
}
function removeFriend(f){
 friends[currentUser]=friends[currentUser].filter(x=>x!==f);
 save(); displayFriends();
}

// ------------------- Admin Panel -------------------
function loadAdmin(){
 let userList = Object.keys(users).map(u=>`<p>${u} (${users[u].rank})</p>`).join('');
 document.getElementById('admin').innerHTML=`
 <h2>Admin Panel</h2>
 <h3>Create User</h3>
 <input id="newUser" placeholder="Username">
 <input id="newPass" placeholder="Password">
 <input id="newRoblox" placeholder="Roblox UserID">
 <select id="newRole"><option>Member</option><option>Trainer</option><option>Admin</option></select>
 <input id="newClass" placeholder="Class / Regiment">
 <button onclick="addUser()">Create User</button>
 <hr>
 <h3>Add Schedule</h3>
 <select id="scheduleRegiment"><option>HQ</option><option>TECOM</option></select>
 <select id="scheduleDay">
   <option>Monday</option><option>Tuesday</option><option>Wednesday</option>
   <option>Thursday</option><option>Friday</option><option>Saturday</option><option>Sunday</option>
 </select>
 <input id="trainingType" placeholder="Training Type">
 <input id="trainingTime" placeholder="Time (10:00-12:00)">
 <input id="trainerUser" placeholder="Trainer Username">
 <input id="trainerRank" placeholder="Trainer Rank">
 <input id="location" placeholder="Location">
 <input id="extraInfo" placeholder="Extra Info">
 <button onclick="addSchedule()">Add Schedule</button>
 <hr>
 <h3>Existing Users</h3>${userList}`;
}

function addUser(){
 let newUser=document.getElementById('newUser').value;
 let newPass=document.getElementById('newPass').value;
 let newRoblox=document.getElementById('newRoblox').value;
 let newRole=document.getElementById('newRole').value;
 let newClass=document.getElementById('newClass').value;
 users[newUser]={password:newPass,robloxId:newRoblox,role:newRole,rank:1,class:newClass};
 save(); loadAdmin();
}

// ------------------- Schedule toevoegen -------------------
function addSchedule(){
 let regiment=document.getElementById('scheduleRegiment').value;
 let day=document.getElementById('scheduleDay').value;
 if(!schedule[regiment]) schedule[regiment]={};
 if(!schedule[regiment][day]) schedule[regiment][day]=[];
 schedule[regiment][day].push({
   trainingType:document.getElementById('trainingType').value,
   time:document.getElementById('trainingTime').value,
   trainerUser:document.getElementById('trainerUser').value,
   trainerRank:document.getElementById('trainerRank').value,
   location:document.getElementById('location').value,
   extra:document.getElementById('extraInfo').value
 });
 save(); displaySchedule();
}

// ------------------- Trainer Panel -------------------
function loadTrainerPanel(){
 let u=users[currentUser];
 let students=Object.keys(users).filter(s=>users[s].role==='Member' && users[s].class===u.class);
 let html='<h2>Trainer Panel</h2>';
 html+=`Group ID: <input id="groupIdInput" value="6048775" />`;
 students.forEach(s=>{
   html+=`<p>${s} - Current Rank: ${users[s].rank}</p>
   <select id="rankSelect_${s}"><option value="200">Private</option><option value="300">Corporal</option><option value="400">Sergeant</option><option value="500">Lieutenant</option></select>
   <button onclick="updateRank('${s}')">Update Rank</button><br>
   <input id="gradeTitle_${s}" placeholder="Title">
   <input id="gradeScore_${s}" placeholder="Score or Good/Bad">
   <input type="checkbox" id="gradeAttendance_${s}">Present
   <button onclick="addGrade('${s}')">Add Grade</button>`;
 });
 document.getElementById('trainer').innerHTML=html;
}

function updateRank(username){
 let student=users[username];
 let rankId=parseInt(document.getElementById(`rankSelect_${username}`).value);
 let groupId=parseInt(document.getElementById('groupIdInput').value);
 student.rank=rankId; save(); loadTrainerPanel(); alert(`${username} rank updated`);
}

function addGrade(username){
 let title=document.getElementById(`gradeTitle_${username}`).value;
 let score=document.getElementById(`gradeScore_${username}`).value;
 let attendance=document.getElementById(`gradeAttendance_${username}`).checked?'Present':'Absent';
 if(!grades[username]) grades[username]=[];
 grades[username].push({title, score, attendance, trainer:currentUser, date:new Date().toLocaleDateString()});
 save(); displayGrades();
 alert(`Grade added for ${username}`);
}

// ------------------- Chat -------------------
function sendMessage(to, content, type='private', image=null){
 messages.push({from:currentUser,to,content,type,date:new Date().toLocaleString(),image});
 save();
 alert('Message sent');
}
</script>
</body>
</html>
